@using fletnix.Models
@using fletnix.ViewModels
@{
    ViewData["Title"] = "Home Page";
	Layout = "_Layout";
}

@if (!User.Identity.IsAuthenticated)
{
	<div class="home-container">
		<div style="margin-top: 17%;">
			<h1 class="cta-pitch" style="color: white; font-size: 6.4em; font-family: arial">See what’s next</h1>
			<h2 style="font-weight: 400;" class="cta-pitch">WATCH ANYWHERE. CANCEL ANYTIME.</h2>
			<button style="text-transform: uppercase; margin-top: 20px; border: none; border-radius: 0px; padding: 7px 20px 7px 20px; color: white; font-size: 1em;" class="fletnix-btn fletnix-red-background">Join free for a month</button>
		</div>
	</div>
}
else
{
	<div class="container-fluid" style="height: 55vh; width: 100%; position: relative; background-color: black; background-position: right 20px top -230px; background-size: cover; background-repeat: no-repeat; background-image:url('/images/moana-backdrop.jpg')">
		<div class="row">
			<div class="col-md-5">
				<div style="margin-top:28vh">
					<h1 style="font-size: 55px; color: white;">Moana (2016)</h1>
					<p style="color: white;">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer quam neque, facilisis in egestas ut, efficitur at mi. Vestibulum vel quam quis eros congue dapibus id eget sem. Sed id dictum urna. Mauris sagittis odio mauris, eu dapibus sapien placerat ut. Duis sed elit nunc. Nullam nec ante ac dui varius posuere. Praesent a lacus aliquet, dapibus odio quis, tempus lacus. Fusce malesuada scelerisque nisl sit amet eleifend.</p>
					<button class="btn fletnix-red-background  fletnix-btn" style="margin-top: 25px; color: white;">Continue watching</button>
				</div>
			</div>
		</div>
	</div>


	if (((List<PopularMoviesViewModel>) ViewData["WatchHistory"]).Count > 0)
	{
		<div class="container-fluid" style="background-color: #141414; margin-top: 50px; margin-bottom: 25px;">
			<h2 style="color: #8E8E8E; font-size: 18px; font-family: arial;">My list</h2>
			<div style="overflow-x: scroll; white-space: nowrap;">
				<div style="width: 999999px;">
					@foreach (var movie in (List<PopularMoviesViewModel>) ViewData["WatchHistory"])
					{
						<a asp-route-id="@movie.Movie.MovieId" asp-action="movie" asp-controller="home">
							<div style="width: 350px; float: left; margin-right: 10px; margin-bottom: 30px;">
								<div class="movie" style="position: relative; min-height: 170px; color: white; text-align: center;" data-id="@movie.Movie.MovieId" data-title="@movie.Movie.Title">
									<div style="background-color: #141414; padding: 5px; position: absolute; z-index: 99; font-size: 16px; top: 150px; left: 10px; color: #8E8E8E;">@movie.Movie.Title</div>
									<img class="movie-poster-@movie.Movie.MovieId" src="~/images/no-backdrop.jpg" style="width: 100%;"/>
								</div>
							</div>
						</a>
					}
				</div>
			</div>
		</div>
	}

	if (((List<PopularMoviesViewModel>) ViewData["MostPopularOfLastTwoWeeks"]).Count > 0)
	 {
		 <div class="container-fluid" style="background-color: #141414; margin-top: 15px;">
			 <h2 style="color: #8E8E8E; font-size: 18px; font-family: arial;">Most popular movies of the last two weeks</h2>
			 <div style="overflow-x: scroll; white-space: nowrap;">
				 <div style="width: 999999px;">
					 @foreach (var movie in (List<PopularMoviesViewModel>) ViewData["MostPopularOfLastTwoWeeks"])
					 {
						 <a asp-route-id="@movie.Movie.MovieId" asp-action="movie" asp-controller="home">
							 <div style="width: 350px; float: left; margin-right: 10px; margin-bottom: 30px;">
								 <div class="movie" style="position: relative; min-height: 170px; color: white; text-align: center;" data-id="@movie.Movie.MovieId" data-title="@movie.Movie.Title">
									 <div style="background-color: #141414; padding: 5px; position: absolute; z-index: 99; font-size: 16px; top: 150px; left: 10px; color: #8E8E8E;">@movie.Movie.Title</div>
									 <img class="movie-poster-@movie.Movie.MovieId" src="~/images/no-backdrop.jpg" style="width: 100%;"/>
								 </div>
							 </div>
						 </a>
					 }
				 </div>
			 </div>
		 </div>
	 }

	<div class="container-fluid" style="background-color: #141414; margin-top: 15px;">
		<h2 style="color: #8E8E8E;  font-size: 18px; font-family: arial;">Most popular movies of all time</h2>
		<div style="overflow-x: scroll; white-space: nowrap;">
			<div style="width: 999999px;">
			@foreach (var movie in (List<PopularMoviesViewModel>) ViewData["MostPopularOfAllTime"])
			{
				<a asp-route-id="@movie.Movie.MovieId" asp-action="movie" asp-controller="home">
				<div style="width: 350px; float: left; margin-right: 10px; margin-bottom:30px;">
					<div class="movie" style="position: relative; min-height: 170px; color: white; text-align: center;" data-id="@movie.Movie.MovieId" data-title="@movie.Movie.Title">
						<div style="background-color:#141414; padding: 5px; position: absolute; z-index: 99; font-size: 16px; top: 150px; left: 10px; color:  #8E8E8E;">@movie.Movie.Title</div>
						<img class="movie-poster-@movie.Movie.MovieId" src="~/images/no-backdrop.jpg" style="width: 100%;"/>
					</div>
				</div>
				</a>
			}
			</div>
		</div>
	</div>
@section scripts {
	<script>
		$(document).ready(function() {

			$(".movie").each(function(index) {
				getPoster($(this).data('id'), $('.movie-poster-' + $(this).data('id')), $(this).data('title'));
			});
		});

		function getPoster(id, element, title) {
			$.get('https://api.themoviedb.org/3/search/movie?api_key=8f3879e8c91096e1e468cf6c539dc1e7&query=' +
				encodeURI(title),
				(res) => {
					if (res.results[0]) {
						if (res.results[0].backdrop_path) {
							//poster_path
							element.attr('src', 'https://image.tmdb.org/t/p/w500/' + res.results[0].backdrop_path);
						}
					} else {
						element.attr('src', '/images/no-backdrop.jpg');
					}
				});
		}
	</script>
}
}


